#!/usr/bin/env perl

my @branches;
while (<>) {
    print;

    # If we found an empty line, the section with the rebase instructions is
    # done.
    if ($_ eq "\n") {
        if (@branches) {
            print "# Uncomment this section to push the changes.\n";
            for my $branch (@branches) {
                print "# exec git push -f origin $branch\n";
            }
            print "\n";
        }
    }

    next unless /^pick /;
    next unless m/\(([^)]+)\)$/g;
    for (split /, ?/, $1) {
        if (-e ".git/refs/heads/$_") {
            print "exec git branch -f $_\n";
            push @branches, $_;
        }
    }
}
